# Copilot instructions: PHP

<!-- generated by ai-instructions-pilot: sets: php, laravel -->

## Language & Runtime

Core expectations for modern PHP code.

- Target PHP 8.4 with strict_types=1;
- Follow PSR-12 code style and naming conventions;
- Use readonly, enum, and intersection types where appropriate;
- Prefer typed properties and promoted constructor parameters;
- Leverage `match`, `nullsafe`, and `first-class callable` syntax for clarity;
- Use native attributes for metadata instead of PHPDoc when possible;
- Avoid dynamic (runtime) property creation—declare all explicitly;
- Use `declare(strict_types=1);` at the top of all PHP files.

## Testing & Quality

Maintain robustness and clarity through testing and static analysis.

- Use PHPUnit for testing;
- Run PHPStan at level 8+ for static analysis;
- Ensure 100% strict typing coverage.

## Performance & Architecture

Modern PHP applications should be efficient, composable, and predictable.

- Prefer immutable data structures and pure functions when practical;
- Avoid unnecessary object instantiation in hot paths;
- Use `readonly` classes and properties for clear intent and optimization.

## Core Laravel Principle

Follow Laravel conventions first. If Laravel has a documented way to do something, use it. Only deviate when there is a clear justification.

## PHP Standards

- Follow PSR-1, PSR-2, and PSR-12.
- Use camelCase for non-public-facing strings.
- Use short nullable notation: `?string` not `string|null`.
- Always specify `void` return types when methods return nothing.

## Class Structure

- Use typed properties, not docblocks.
- Use constructor property promotion when all properties can be promoted.
- Use one trait per line.

## Type Declarations & Docblocks

- Use typed properties over docblocks.
- Specify return types including `void`.
- Use short nullable syntax: `?Type` not `Type|null`.
- Document iterables with generics using `@return Collection<int, User>` style.

## Docblock Rules

- Don't use docblocks for fully type-hinted methods unless a description is needed.
- Always import classnames in docblocks — never use fully qualified names.
- Use one-line docblocks when possible: `/** @var string */`.
- Most common type should be listed first in multi-type docblocks.
- If one parameter needs a docblock, add docblocks for all parameters.
- For iterables, always specify key and value types.
- Use array shape notation for fixed keys, with each key on its own line.

## Control Flow

- Handle error conditions first, success case last (happy path last).
- Avoid `else` statements — use early returns.
- Prefer multiple simple `if` statements over compound conditions.
- Always use curly braces, even for single statements.
- Each ternary part on its own line unless very short.

## Laravel Conventions

## Strings & Formatting

- Prefer string interpolation over concatenation.

## Enums

- Use PascalCase for enum values.

## Comments

- Avoid comments — write expressive code instead.
- Use proper formatting for necessary comments.
- Refactor comments into descriptive function names.

## Whitespace

- Add blank lines between logical statements for readability.
- Avoid extra empty lines between `{}` brackets.
- Keep sequences of equivalent single-line operations grouped.
- Let code breathe — avoid cramped formatting.

## Validation

- Use array notation for multiple rules for readability.
- Custom validation rules use snake_case.

## Authorization

- Policies use camelCase: `Gate::define('editPost', ...)`.
- Use CRUD verbs, but `view` instead of `show`.

## Translations

- Use the `__()` function over `@lang`.

## API Routing

- Use plural resource names: `/errors`.
- Use kebab-case: `/error-occurrences`.
- Avoid deep nesting for clarity and simplicity.

## Testing

- Keep test classes in the same file when possible.
- Use descriptive test method names.
- Follow the Arrange-Act-Assert pattern.

## Quick Reference

## Migrations

- Only implement `up()` methods; leave out `down()` unless rollback is required.

## Code Quality Reminders

- Use typed properties over docblocks.
- Prefer early returns over nested if/else.
- Use constructor property promotion when all properties can be promoted.
- Avoid `else` statements when possible.
- Use string interpolation over concatenation.
- Always use curly braces for control structures.

## Attribution

These guidelines are made by the AI team at CEGO

